#!/bin/bash

set -euo pipefail
IFS=$'\n\t'

cd "$(dirname "$(readlink -f "$0")")"

case "${1:-}" in
    login)
        podman login
        ;;

    build)
        buildah bud -t ghcr.io/davekok/lalr1:test test.containerfile
        ;;

    push)
        podman push ghcr.io/davekok/lalr1:test
        ;;

    test)
        podman run -it --rm -v ./src:/app/src -v ./tests:/app/tests ghcr.io/davekok/lalr1:test
        ;;

    "")
        echo "Usage: $0 ( login | build | push | test )"
        ;;
esac
